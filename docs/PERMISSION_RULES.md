# Token Manager æ¬Šé™è¦å‰‡å®Œæ•´æ–‡æª”

## ğŸ“ æ ¸å¿ƒæ¶æ§‹

### Per-Team Roles
```
æ¯å€‹ç”¨æˆ¶åœ¨æ¯å€‹åœ˜éšŠæœ‰ç¨ç«‹çš„è§’è‰²
è§’è‰²ç¶å®šåœ¨ (user_id, team_id) ä¸Š
```

### æ•¸æ“šå­˜å„²
```
PostgreSQL:
  - teams è¡¨ï¼ˆåœ˜éšŠå®šç¾©ï¼‰

Clerk Metadata:
  - user.publicMetadata["tokenManager:teamRoles"]
    {
      "backend-team": "ADMIN",
      "platform-team": "DEVELOPER"
    }
```

---

## ğŸ” æ¬Šé™è¦å‰‡

### 1. é é¢è¨ªå•æ¬Šé™

#### ç”¨æˆ¶ç®¡ç†é é¢
```
æ¢ä»¶ï¼šåœ¨ä»»ä¸€åœ˜éšŠæ˜¯ ADMIN æˆ– MANAGER
```

#### åœ˜éšŠç®¡ç†é é¢
```
æ¢ä»¶ï¼šåœ¨ä»»ä¸€åœ˜éšŠæ˜¯ ADMIN æˆ– MANAGER
```

#### Token ç®¡ç† / è·¯ç”±ç®¡ç†
```
æ¢ä»¶ï¼šåœ¨ä»»ä¸€åœ˜éšŠæœ‰è§’è‰²ï¼ˆDEVELOPER ä»¥ä¸Šï¼‰
```

---

### 2. åœ˜éšŠç®¡ç†æ¬Šé™

#### å‰µå»ºåœ˜éšŠ
```
èª°å¯ä»¥ï¼šä»»ä¸€åœ˜éšŠçš„ ADMIN
çµæœï¼šå‰µå»ºè€…è‡ªå‹•æˆç‚ºæ–°åœ˜éšŠçš„ ADMIN
```

#### ç·¨è¼¯åœ˜éšŠä¿¡æ¯
```
èª°å¯ä»¥ï¼š
  1. è©²åœ˜éšŠçš„ ADMIN
  2. å¦‚æœåœ˜éšŠæ²’æœ‰æˆå“¡ï¼Œä»»ä½• ADMIN å¯ä»¥èªé ˜ä¸¦ç·¨è¼¯
```

#### åˆªé™¤åœ˜éšŠ
```
èª°å¯ä»¥ï¼šä»»ä¸€åœ˜éšŠçš„ ADMIN
å‰ææ¢ä»¶ï¼šåœ˜éšŠå¿…é ˆæ²’æœ‰æˆå“¡
å¦‚æœæœ‰æˆå“¡ï¼šæ‹’çµ•ä¸¦åˆ—å‡ºæˆå“¡ email
```

#### æŸ¥çœ‹åœ˜éšŠåˆ—è¡¨
```
èª°å¯ä»¥ï¼šæ‰€æœ‰ç™»å…¥ç”¨æˆ¶
```

#### æŸ¥çœ‹åœ˜éšŠæˆå“¡
```
èª°å¯ä»¥ï¼š
  1. è©²åœ˜éšŠçš„æˆå“¡
  2. ä»»ä¸€åœ˜éšŠçš„ ADMIN
```

---

### 3. æˆå“¡ç®¡ç†æ¬Šé™

#### æ·»åŠ æˆå“¡åˆ°åœ˜éšŠ
```
èª°å¯ä»¥ï¼š
  1. è©²åœ˜éšŠçš„ ADMIN æˆ– MANAGER
  2. ç©ºåœ˜éšŠï¼šä»»ä½• ADMIN å¯ä»¥èªé ˜ä¸¦æ·»åŠ ï¼ˆè‡ªå·±æœƒæˆç‚º ADMINï¼‰

MANAGER é™åˆ¶ï¼š
  - ä¸èƒ½æ·»åŠ  ADMIN æˆ– MANAGER è§’è‰²
  - åªèƒ½æ·»åŠ  DEVELOPER æˆ– VIEWER
```

#### ä¿®æ”¹æˆå“¡è§’è‰²
```
èª°å¯ä»¥ï¼šè©²åœ˜éšŠçš„ ADMIN æˆ– MANAGER

ADMINï¼š
  - å¯ä»¥è¨­ç½®ä»»ä½•è§’è‰²ï¼ˆADMIN, MANAGER, DEVELOPER, VIEWERï¼‰

MANAGERï¼š
  - ä¸èƒ½è¨­ç½® ADMIN æˆ– MANAGER
  - ä¸èƒ½ç·¨è¼¯å·²ç¶“æ˜¯ ADMIN æˆ– MANAGER çš„æˆå“¡
  - åªèƒ½è¨­ç½® DEVELOPER æˆ– VIEWER
```

#### ç§»é™¤æˆå“¡
```
èª°å¯ä»¥ï¼šè©²åœ˜éšŠçš„ ADMIN æˆ– MANAGER

ADMINï¼š
  - å¯ä»¥ç§»é™¤ä»»ä½•æˆå“¡

MANAGERï¼š
  - ä¸èƒ½ç§»é™¤ ADMIN æˆ– MANAGER
  - åªèƒ½ç§»é™¤ DEVELOPER æˆ– VIEWER
```

---

### 4. ç”¨æˆ¶é‚€è«‹æ¬Šé™

#### é‚€è«‹æ–°ç”¨æˆ¶
```
èª°å¯ä»¥ï¼šä»»ä¸€åœ˜éšŠçš„ ADMIN
å¯ä»¥åšä»€éº¼ï¼š
  - è¼¸å…¥ email
  - é¸æ“‡åˆå§‹åœ˜éšŠå’Œè§’è‰²
  - åªèƒ½é¸æ“‡è‡ªå·±æ˜¯ ADMIN/MANAGER çš„åœ˜éšŠ
```

---

### 5. è³‡æºç®¡ç†æ¬Šé™ï¼ˆToken, Routeï¼‰

#### æŸ¥çœ‹è³‡æº
```
æ¢ä»¶ï¼šåœ¨è©²è³‡æºæ‰€å±¬åœ˜éšŠæœ‰è§’è‰²
```

#### å‰µå»ºè³‡æº
```
èª°å¯ä»¥ï¼šè©²åœ˜éšŠçš„ ADMIN, MANAGER, DEVELOPER
ä¸å¯ä»¥ï¼šVIEWER
```

#### ç·¨è¼¯è³‡æº
```
ADMINï¼šå¯ä»¥ç·¨è¼¯è©²åœ˜éšŠæ‰€æœ‰è³‡æº
MANAGERï¼šå¯ä»¥ç·¨è¼¯è©²åœ˜éšŠæ‰€æœ‰è³‡æº
DEVELOPERï¼šåªèƒ½ç·¨è¼¯è‡ªå·±å‰µå»ºçš„è³‡æº
VIEWERï¼šä¸èƒ½ç·¨è¼¯
```

#### åˆªé™¤è³‡æº
```
ADMINï¼šå¯ä»¥åˆªé™¤è©²åœ˜éšŠæ‰€æœ‰è³‡æº
MANAGERï¼šå¯ä»¥åˆªé™¤è©²åœ˜éšŠæ‰€æœ‰è³‡æº
DEVELOPERï¼šåªèƒ½åˆªé™¤è‡ªå·±å‰µå»ºçš„è³‡æº
VIEWERï¼šä¸èƒ½åˆªé™¤
```

---

## ğŸ¯ è§’è‰²å±¤ç´š

### å±¤ç´šçµæ§‹
```
ADMIN > MANAGER > DEVELOPER > VIEWER
```

### æ¯å€‹è§’è‰²çš„èƒ½åŠ›

#### ADMINï¼ˆç³»çµ±ç®¡ç†å“¡ï¼‰ğŸ‘‘
**åœ˜éšŠå±¤ç´šï¼š**
- ç®¡ç†è©²åœ˜éšŠæ‰€æœ‰æˆå“¡
- è¨­ç½®ä»»ä½•è§’è‰²
- ç·¨è¼¯/åˆªé™¤åœ˜éšŠ
- èªé ˜ç©ºåœ˜éšŠ

**å…¨å±€å±¤ç´šï¼š**
- å‰µå»ºæ–°åœ˜éšŠ
- åˆªé™¤ç©ºåœ˜éšŠ
- é‚€è«‹æ–°ç”¨æˆ¶
- è¨ªå•åœ˜éšŠ/ç”¨æˆ¶ç®¡ç†é é¢

**è³‡æºå±¤ç´šï¼š**
- ç®¡ç†è©²åœ˜éšŠæ‰€æœ‰è³‡æº

#### MANAGERï¼ˆåœ˜éšŠç®¡ç†è€…ï¼‰â­
**åœ˜éšŠå±¤ç´šï¼š**
- ç®¡ç†è©²åœ˜éšŠçš„ DEVELOPER å’Œ VIEWER
- ä¸èƒ½è¨­ç½®/ç·¨è¼¯ ADMIN æˆ– MANAGER
- ä¸èƒ½åˆªé™¤åœ˜éšŠ

**å…¨å±€å±¤ç´šï¼š**
- è¨ªå•åœ˜éšŠ/ç”¨æˆ¶ç®¡ç†é é¢

**è³‡æºå±¤ç´šï¼š**
- ç®¡ç†è©²åœ˜éšŠæ‰€æœ‰è³‡æº

#### DEVELOPERï¼ˆé–‹ç™¼è€…ï¼‰ğŸ’»
**åœ˜éšŠå±¤ç´šï¼š**
- ç„¡æˆå“¡ç®¡ç†æ¬Šé™

**è³‡æºå±¤ç´šï¼š**
- å‰µå»ºè³‡æº
- ç·¨è¼¯/åˆªé™¤è‡ªå·±çš„è³‡æº

#### VIEWERï¼ˆæª¢è¦–è€…ï¼‰ğŸ‘ï¸
**è³‡æºå±¤ç´šï¼š**
- åªèƒ½æŸ¥çœ‹

---

## ğŸ”„ ç‰¹æ®Šæ©Ÿåˆ¶

### ç©ºåœ˜éšŠèªé ˜
```
æ¢ä»¶ï¼š
  1. åœ˜éšŠæ²’æœ‰ä»»ä½•æˆå“¡
  2. ä½ åœ¨å…¶ä»–åœ˜éšŠæ˜¯ ADMIN

è¡Œç‚ºï¼š
  - ç·¨è¼¯åœ˜éšŠæ™‚å¯ä»¥èªé ˜
  - æ·»åŠ æˆå“¡æ™‚å¯ä»¥èªé ˜
  - èªé ˜å¾Œæˆç‚ºè©²åœ˜éšŠ ADMIN
```

### åœ˜éšŠåˆªé™¤ä¿è­·
```
è¦å‰‡ï¼šåªèƒ½åˆªé™¤ç©ºåœ˜éšŠ

æª¢æŸ¥æ©Ÿåˆ¶ï¼š
  1. æŸ¥è©¢æ‰€æœ‰ Clerk ç”¨æˆ¶çš„ teamRoles
  2. çµ±è¨ˆè©²åœ˜éšŠçš„æˆå“¡æ•¸
  3. å¦‚æœ > 0ï¼šæ‹’çµ•ä¸¦åˆ—å‡ºæˆå“¡
```

### Metadata åˆªé™¤
```
Clerk çš„ update_metadata æ˜¯ merge è¡Œç‚º

åˆªé™¤æ–¹å¼ï¼šè¨­ç½®ç‚º null
{
  "tokenManager:teamRoles": {
    "backend-team": "ADMIN",
    "frontend-team": null  // â† å·²åˆªé™¤
  }
}

å‰ç«¯è™•ç†ï¼š
  - getUserTeams() éæ¿¾ null
  - getAllTeamRoles() éæ¿¾ null
```

---

## ğŸ¨ UI æ¬Šé™å°æ‡‰

### æŒ‰éˆ•é¡¯ç¤ºé‚è¼¯

| åŠŸèƒ½ | é¡¯ç¤ºæ¢ä»¶ | ç¦ç”¨æ¢ä»¶ |
|------|---------|---------|
| å‰µå»ºåœ˜éšŠ | ADMIN | - |
| ç·¨è¼¯åœ˜éšŠ | ADMIN | ä¸æ˜¯è©²åœ˜éšŠ ADMIN ä¸”åœ˜éšŠæœ‰æˆå“¡ |
| åˆªé™¤åœ˜éšŠ | ADMIN | åœ˜éšŠæœ‰æˆå“¡ |
| é‚€è«‹ç”¨æˆ¶ | ADMIN | - |
| ç·¨è¼¯ç”¨æˆ¶ | è‡³å°‘å¯ç®¡ç†ä¸€å€‹å…±åŒåœ˜éšŠ | - |
| æ·»åŠ æˆå“¡åˆ°åœ˜éšŠ | è©²åœ˜éšŠ ADMIN/MANAGER æˆ–ç©ºåœ˜éšŠå¯èªé ˜ | - |
| ä¿®æ”¹æˆå“¡è§’è‰² | è©²åœ˜éšŠ ADMIN/MANAGER | MANAGER ç·¨è¼¯ ADMIN/MANAGER |
| ç§»é™¤æˆå“¡ | è©²åœ˜éšŠ ADMIN/MANAGER | MANAGER ç§»é™¤ ADMIN/MANAGER |

---

## ğŸ§ª æ¸¬è©¦å ´æ™¯

### å ´æ™¯ 1ï¼šADMIN ç®¡ç†å¤šåœ˜éšŠ
```
Joey (Backend ADMIN, Platform ADMIN)

å¯ä»¥ï¼š
âœ… å‰µå»ºæ–°åœ˜éšŠ
âœ… ç·¨è¼¯ Backend/Platform åœ˜éšŠ
âœ… åˆªé™¤ç©ºåœ˜éšŠ
âœ… ç®¡ç† Backend/Platform æˆå“¡
âœ… èªé ˜å…¶ä»–ç©ºåœ˜éšŠ
âœ… é‚€è«‹æ–°ç”¨æˆ¶

ä¸å¯ä»¥ï¼š
âŒ åˆªé™¤æœ‰æˆå“¡çš„åœ˜éšŠ
âŒ ç·¨è¼¯å…¶ä»–æœ‰æˆå“¡åœ˜éšŠçš„ä¿¡æ¯ï¼ˆé™¤éèªé ˜ï¼‰
```

### å ´æ™¯ 2ï¼šMANAGER ç®¡ç†å–®åœ˜éšŠ
```
Alice (Backend MANAGER)

å¯ä»¥ï¼š
âœ… ç®¡ç† Backend çš„ DEVELOPER/VIEWER
âœ… æŸ¥çœ‹åœ˜éšŠåˆ—è¡¨
âœ… æŸ¥çœ‹ Backend æˆå“¡

ä¸å¯ä»¥ï¼š
âŒ å‰µå»ºåœ˜éšŠ
âŒ åˆªé™¤åœ˜éšŠ
âŒ ç·¨è¼¯åœ˜éšŠä¿¡æ¯
âŒ ç®¡ç† Backend çš„ ADMIN/MANAGER
âŒ é‚€è«‹æ–°ç”¨æˆ¶
âŒ èªé ˜å…¶ä»–åœ˜éšŠ
```

### å ´æ™¯ 3ï¼šè·¨åœ˜éšŠç”¨æˆ¶
```
Bob (Backend ADMIN, Platform DEVELOPER)

Backend æ¬Šé™ï¼š
âœ… ç®¡ç†æ‰€æœ‰ Backend æˆå“¡
âœ… ç·¨è¼¯ Backend åœ˜éšŠ

Platform æ¬Šé™ï¼š
âŒ ä¸èƒ½ç®¡ç† Platform æˆå“¡ï¼ˆä¸æ˜¯ ADMIN/MANAGERï¼‰
âœ… å¯ä»¥å‰µå»º Platform è³‡æº

å…¨å±€æ¬Šé™ï¼š
âœ… å‰µå»ºæ–°åœ˜éšŠï¼ˆå› ç‚ºæœ‰ä¸€å€‹ ADMINï¼‰
âœ… èªé ˜ç©ºåœ˜éšŠ
âœ… é‚€è«‹ç”¨æˆ¶
```

---

## ğŸ”§ æ•¸æ“šä¸€è‡´æ€§ä¿è­‰

### åœ˜éšŠåˆªé™¤
```
1. æª¢æŸ¥æˆå“¡æ•¸ï¼ˆæŸ¥è©¢æ‰€æœ‰ Clerk ç”¨æˆ¶ï¼‰
2. æœ‰æˆå“¡ â†’ æ‹’çµ•
3. ç„¡æˆå“¡ â†’ å…è¨±åˆªé™¤
```

### æ·»åŠ æˆå“¡
```
1. æª¢æŸ¥åœ˜éšŠæ˜¯å¦å­˜åœ¨ï¼ˆPostgreSQLï¼‰
2. ä¸å­˜åœ¨ â†’ æ‹’çµ•
3. å­˜åœ¨ â†’ æ›´æ–° Clerk metadata
```

### ç§»é™¤æˆå“¡
```
1. è¨­ç½® teamRoles[team_id] = null
2. å‰ç«¯éæ¿¾ null å€¼
3. Metadata ä¸­ä¿ç•™ nullï¼ˆä¸çœŸåˆªé™¤ keyï¼‰
```

### å­¤å…’æ•¸æ“šè™•ç†
```
é¡¯ç¤ºè¦å‰‡ï¼š
  - åªé¡¯ç¤ºã€ŒMetadata æœ‰ AND PostgreSQL æœ‰ã€çš„åœ˜éšŠ
  - è‡ªå‹•éæ¿¾ null
  - è‡ªå‹•éæ¿¾å·²åˆªé™¤çš„åœ˜éšŠ
```

---

## ğŸ“Š å®Œæ•´æ¬Šé™çŸ©é™£

| æ“ä½œ | ADMIN | MANAGER | DEVELOPER | VIEWER |
|------|-------|---------|-----------|--------|
| **åœ˜éšŠç®¡ç†** |  |  |  |  |
| å‰µå»ºåœ˜éšŠ | âœ… | âŒ | âŒ | âŒ |
| ç·¨è¼¯åœ˜éšŠä¿¡æ¯ | âœ… | âŒ | âŒ | âŒ |
| åˆªé™¤åœ˜éšŠ | âœ… (ç©º) | âŒ | âŒ | âŒ |
| èªé ˜ç©ºåœ˜éšŠ | âœ… | âŒ | âŒ | âŒ |
| **æˆå“¡ç®¡ç†** |  |  |  |  |
| æ·»åŠ æˆå“¡ | âœ… | âœ… | âŒ | âŒ |
| è¨­ç‚º ADMIN/MANAGER | âœ… | âŒ | âŒ | âŒ |
| è¨­ç‚º DEVELOPER/VIEWER | âœ… | âœ… | âŒ | âŒ |
| ç·¨è¼¯ ADMIN/MANAGER | âœ… | âŒ | âŒ | âŒ |
| ç·¨è¼¯ DEVELOPER/VIEWER | âœ… | âœ… | âŒ | âŒ |
| ç§»é™¤ ADMIN/MANAGER | âœ… | âŒ | âŒ | âŒ |
| ç§»é™¤ DEVELOPER/VIEWER | âœ… | âœ… | âŒ | âŒ |
| **ç”¨æˆ¶ç®¡ç†** |  |  |  |  |
| é‚€è«‹ç”¨æˆ¶ | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹ç”¨æˆ¶åˆ—è¡¨ | âœ… | âœ… | âŒ | âŒ |
| **è³‡æºç®¡ç†** |  |  |  |  |
| æŸ¥çœ‹è³‡æº | âœ… | âœ… | âœ… | âœ… |
| å‰µå»ºè³‡æº | âœ… | âœ… | âœ… | âŒ |
| ç·¨è¼¯æ‰€æœ‰è³‡æº | âœ… | âœ… | âŒ | âŒ |
| ç·¨è¼¯è‡ªå·±çš„è³‡æº | âœ… | âœ… | âœ… | âŒ |
| åˆªé™¤æ‰€æœ‰è³‡æº | âœ… | âœ… | âŒ | âŒ |
| åˆªé™¤è‡ªå·±çš„è³‡æº | âœ… | âœ… | âœ… | âŒ |

---

## ğŸ› å·²çŸ¥é™åˆ¶èˆ‡è§£æ±ºæ–¹æ¡ˆ

### Clerk Metadata é™åˆ¶

**å•é¡Œï¼š** `update_metadata` æ˜¯ merge è¡Œç‚ºï¼Œä¸èƒ½ç›´æ¥åˆªé™¤ nested key

**è§£æ±ºæ–¹æ¡ˆï¼š** è¨­ç½®ç‚º null
```python
# åˆªé™¤æ™‚
update_payload = {
  "tokenManager:teamRoles": {
    **current_roles,
    "team-to-remove": None  # â† null è¡¨ç¤ºå·²åˆªé™¤
  }
}
```

**å‰ç«¯è™•ç†ï¼š** éæ¿¾ null å€¼
```javascript
const getUserTeams = () => {
  const teamRoles = {...};
  return Object.keys(teamRoles).filter(t => teamRoles[t] !== null);
};
```

### åœ˜éšŠåˆ—è¡¨ç¡¬ç·¨ç¢¼

**å•é¡Œï¼š** ä¹‹å‰ `constants/roles.js` æœ‰ç¡¬ç·¨ç¢¼åœ˜éšŠ

**è§£æ±ºæ–¹æ¡ˆï¼š** å·²æ¸…ç©º TEAMSï¼Œæ‰€æœ‰åœ˜éšŠå¾ API å‹•æ…‹ç²å–
```javascript
// âŒ èˆŠçš„
import { TEAMS } from './constants/roles';
const team = TEAMS.BACKEND;

// âœ… æ–°çš„
const [teams, setTeams] = useState([]);
useEffect(() => {
  fetch('/api/teams').then(data => setTeams(data));
}, []);
const team = teams.find(t => t.id === teamId);
```

### ç©ºåœ˜éšŠç®¡ç†

**å•é¡Œï¼š** 0 æˆå“¡çš„åœ˜éšŠç„¡äººå¯ç®¡ç†

**è§£æ±ºæ–¹æ¡ˆï¼š** èªé ˜æ©Ÿåˆ¶
- ä»»ä½• ADMIN å¯ä»¥èªé ˜ç©ºåœ˜éšŠ
- UI é¡¯ç¤ºã€Œèªé ˜æ­¤åœ˜éšŠã€æŒ‰éˆ•
- èªé ˜å¾Œæˆç‚ºè©²åœ˜éšŠ ADMIN

---

## ğŸ“ API ç«¯é»ç¸½è¦½

### åœ˜éšŠç®¡ç†
```
GET    /api/teams                              åˆ—å‡ºæ‰€æœ‰åœ˜éšŠ
POST   /api/teams                              å‰µå»ºåœ˜éšŠï¼ˆADMINï¼‰
GET    /api/teams/{team_id}                    ç²å–åœ˜éšŠè©³æƒ…
PUT    /api/teams/{team_id}                    æ›´æ–°åœ˜éšŠï¼ˆteam ADMIN æˆ–èªé ˜ï¼‰
DELETE /api/teams/{team_id}                    åˆªé™¤åœ˜éšŠï¼ˆADMINï¼Œç©ºåœ˜éšŠï¼‰
GET    /api/teams/{team_id}/members            åˆ—å‡ºåœ˜éšŠæˆå“¡
```

### ç”¨æˆ¶ç®¡ç†
```
GET    /api/users                              åˆ—å‡ºæ‰€æœ‰ç”¨æˆ¶
PUT    /api/users/{user_id}/team-role          æ›´æ–°åœ˜éšŠè§’è‰²
POST   /api/users/{user_id}/team-membership    æ·»åŠ åˆ°åœ˜éšŠ
DELETE /api/users/{user_id}/team-membership/{team_id}  å¾åœ˜éšŠç§»é™¤
```

### é‚€è«‹
```
POST   /api/invitations                        ç™¼é€é‚€è«‹ï¼ˆADMINï¼‰
GET    /api/invitations                        åˆ—å‡ºé‚€è«‹ï¼ˆADMINï¼‰
DELETE /api/invitations/{invitation_id}        æ’¤éŠ·é‚€è«‹ï¼ˆADMINï¼‰
```

---

## ğŸ” Debug æŒ‡å—

### æª¢æŸ¥ç”¨æˆ¶æ¬Šé™
```
1. æ‰“é–‹ç€è¦½å™¨ Console
2. æ‡‰è©²çœ‹åˆ°ï¼šCurrent user teamRoles: {...}
3. æª¢æŸ¥ teamRoles çµæ§‹æ˜¯å¦æ­£ç¢º
```

### æª¢æŸ¥åœ˜éšŠæˆå“¡
```
1. ç·¨è¼¯åœ˜éšŠ
2. æŸ¥çœ‹æˆå“¡åˆ—è¡¨
3. å¦‚æœæˆå“¡æ•¸ä¸å°ï¼Œæª¢æŸ¥ï¼š
   - Clerk metadata æ˜¯å¦æœ‰ null å€¼
   - åœ˜éšŠ ID æ˜¯å¦æ­£ç¢º
```

### å¸¸è¦‹å•é¡Œ

#### Q: ç”¨æˆ¶é¡¯ç¤ºã€Œåœ˜éšŠä¸å­˜åœ¨ã€
**A:** åœ˜éšŠå·²è¢«åˆªé™¤ä½† metadata é‚„æœ‰è©² team_id
- ç³»çµ±æœƒè‡ªå‹•éæ¿¾ä¸é¡¯ç¤º
- æˆ–æ‰‹å‹•åœ¨ Clerk Dashboard æ¸…ç†

#### Q: åˆªé™¤æˆå“¡ç„¡æ•ˆ
**A:** Clerk merge è¡Œç‚º
- å·²ä¿®å¾©ï¼šè¨­ç½®ç‚º null
- å‰ç«¯éæ¿¾ null

#### Q: ç©ºåœ˜éšŠç„¡æ³•ç®¡ç†
**A:** ä½¿ç”¨èªé ˜æ©Ÿåˆ¶
- ä»»ä½• ADMIN å¯ä»¥èªé ˜
- èªé ˜å¾Œæˆç‚ºè©²åœ˜éšŠ ADMIN

---

**ç‰ˆæœ¬ï¼š** v3.0 Per-Team Roles  
**æ›´æ–°æ—¥æœŸï¼š** 2025-11-03  
**æ¶æ§‹ï¼š** PostgreSQL (teams) + Clerk Metadata (teamRoles)

