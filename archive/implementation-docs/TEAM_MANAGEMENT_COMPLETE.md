# åœ˜éšŠç®¡ç†èˆ‡é‚€è«‹åŠŸèƒ½å®Œæˆå ±å‘Š

## âœ… å¯¦ç¾çš„åŠŸèƒ½

### 1. åœ˜éšŠç®¡ç†ï¼ˆå®Œæ•´ CRUDï¼‰
- âœ… åˆ—å‡ºæ‰€æœ‰åœ˜éšŠ
- âœ… å‰µå»ºæ–°åœ˜éšŠ
- âœ… ç·¨è¼¯åœ˜éšŠï¼ˆåç¨±ã€æè¿°ã€é¡è‰²ã€åœ–æ¨™ï¼‰
- âœ… åˆªé™¤åœ˜éšŠ
- âœ… æŸ¥çœ‹åœ˜éšŠæˆå“¡

### 2. ç”¨æˆ¶é‚€è«‹ï¼ˆClerk Invitationsï¼‰
- âœ… é‚€è«‹æ–°ç”¨æˆ¶
- âœ… é¸æ“‡åˆå§‹åœ˜éšŠå’Œè§’è‰²
- âœ… Clerk è‡ªå‹•ç™¼é€éƒµä»¶
- âœ… Google Login æ”¯æŒ

---

## ğŸ“Š æ•¸æ“šæ¶æ§‹

### PostgreSQLï¼ˆåœ˜éšŠå®šç¾©ï¼‰
```sql
teams
  - id (PK)
  - name
  - description
  - color
  - icon
  - created_at
  - created_by
```

### Clerk Metadataï¼ˆæˆå“¡è³‡æ ¼ï¼‰
```json
{
  "tokenManager:teamRoles": {
    "platform-team": "ADMIN",
    "backend-team": "DEVELOPER"
  }
}
```

### åŒæ­¥ä¿è­‰

```python
# ç•¶æ·»åŠ ç”¨æˆ¶åˆ°åœ˜éšŠæ™‚
async def add_user_to_team(user_id, team_id, role):
    # 1. æª¢æŸ¥åœ˜éšŠæ˜¯å¦å­˜åœ¨ï¼ˆDBï¼‰
    team = await db.get_team(team_id)
    if not team:
        raise HTTPException(404, "Team does not exist")
    
    # 2. åœ˜éšŠå­˜åœ¨ â†’ æ›´æ–° Clerk metadata
    update_clerk_metadata(user_id, team_id, role)
```

**ä¿è­‰ï¼š**
- âœ… Clerk metadata ä¸­çš„ team_id ä¸€å®šå°æ‡‰ DB ä¸­å­˜åœ¨çš„åœ˜éšŠ
- âœ… DB æ˜¯æ¬Šå¨ä¾†æºï¼ˆSource of Truthï¼‰
- âœ… ä¸æœƒæœ‰å­¤å…’æ•¸æ“š

---

## ğŸ¯ API ç«¯é»

### åœ˜éšŠç®¡ç†
```
GET    /api/teams                åˆ—å‡ºæ‰€æœ‰åœ˜éšŠ
POST   /api/teams                å‰µå»ºåœ˜éšŠï¼ˆADMIN onlyï¼‰
GET    /api/teams/{id}           ç²å–åœ˜éšŠè©³æƒ…
PUT    /api/teams/{id}           æ›´æ–°åœ˜éšŠï¼ˆteam ADMIN onlyï¼‰
DELETE /api/teams/{id}           åˆªé™¤åœ˜éšŠï¼ˆADMIN onlyï¼‰
GET    /api/teams/{id}/members   åˆ—å‡ºåœ˜éšŠæˆå“¡
```

### é‚€è«‹ç”¨æˆ¶
```
POST   /api/invitations          ç™¼é€é‚€è«‹ï¼ˆADMIN onlyï¼‰
GET    /api/invitations          åˆ—å‡ºå¾…è™•ç†é‚€è«‹ï¼ˆADMIN onlyï¼‰
DELETE /api/invitations/{id}     æ’¤éŠ·é‚€è«‹ï¼ˆADMIN onlyï¼‰
```

---

## ğŸ¨ UI åŠŸèƒ½

### åœ˜éšŠç®¡ç†é é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœ˜éšŠç®¡ç†          [+ å‰µå»ºåœ˜éšŠ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ [ğŸ” æœå°‹åœ˜éšŠ...]                   â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ Platform Team â”€â”€â”€â”€â”             â”‚
â”‚ â”‚ ğŸ—ï¸ Platform Team   â”‚             â”‚
â”‚ â”‚ å¹³å°åŸºç¤è¨­æ–½åœ˜éšŠ   â”‚             â”‚
â”‚ â”‚ 5 å€‹æˆå“¡           â”‚             â”‚
â”‚ â”‚         [ç·¨è¼¯][åˆªé™¤]â”‚             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ Backend Team â”€â”€â”€â”€â”€â”             â”‚
â”‚ â”‚ âš™ï¸ Backend Team    â”‚             â”‚
â”‚ â”‚ å¾Œç«¯é–‹ç™¼åœ˜éšŠ       â”‚             â”‚
â”‚ â”‚ 8 å€‹æˆå“¡           â”‚             â”‚
â”‚ â”‚         [ç·¨è¼¯][åˆªé™¤]â”‚             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰µå»ºåœ˜éšŠ Modal

```
å‰µå»ºæ–°åœ˜éšŠ

åœ˜éšŠ ID *
[marketing-team]
åªèƒ½åŒ…å«å°å¯«å­—æ¯ã€æ•¸å­—å’Œé€£å­—è™Ÿ

åœ˜éšŠåç¨± *
[Marketing Team]

æè¿°
[è¡ŒéŠ·åœ˜éšŠ...]

é¡è‰²         åœ–æ¨™
[ğŸ¨]         [ğŸ“¢]

é è¦½ï¼š
ğŸ“¢ Marketing Team
è¡ŒéŠ·åœ˜éšŠ

        [å–æ¶ˆ]  [å‰µå»ºåœ˜éšŠ]
```

### é‚€è«‹ç”¨æˆ¶ Modal

```
é‚€è«‹ç”¨æˆ¶

ğŸ“§ Email *
[user@example.com]
ç”¨æˆ¶å°‡æ”¶åˆ°éƒµä»¶é‚€è«‹ï¼Œå¯ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥

åˆå§‹åœ˜éšŠå’Œè§’è‰² *

â˜‘ ğŸ—ï¸ Platform Team    [â–¼ DEVELOPER]
â˜ âš™ï¸ Backend Team
â˜‘ ğŸ“Š Data Team         [â–¼ VIEWER]

å·²é¸æ“‡ 2 å€‹åœ˜éšŠ

é‚€è«‹æµç¨‹ï¼š
1. ç³»çµ±ç™¼é€é‚€è«‹éƒµä»¶åˆ°æ­¤ Email
2. ç”¨æˆ¶é»æ“Šéƒµä»¶ä¸­çš„é€£çµ
3. ç”¨æˆ¶ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
4. è‡ªå‹•åˆ†é…æ‰€é¸çš„åœ˜éšŠå’Œè§’è‰²

          [å–æ¶ˆ]  [ç™¼é€é‚€è«‹]
```

---

## ğŸ”„ é‚€è«‹æµç¨‹ï¼ˆSlack æ¨¡å¼ï¼‰

### å®Œæ•´æµç¨‹

```
1. ADMIN è¼¸å…¥ email: user@example.com
   é¸æ“‡åœ˜éšŠï¼š
   - Backend Team: DEVELOPER
   - Platform Team: VIEWER

2. é»æ“Šã€Œç™¼é€é‚€è«‹ã€
   â†“
   èª¿ç”¨ Clerk API:
   POST https://api.clerk.com/v1/invitations
   {
     "email_address": "user@example.com",
     "redirect_url": "http://localhost:5173",
     "public_metadata": {
       "tokenManager:teamRoles": {
         "backend-team": "DEVELOPER",
         "platform-team": "VIEWER"
       }
     }
   }

3. Clerk è‡ªå‹•ç™¼é€éƒµä»¶
   æ¨™é¡Œï¼šã€ŒYou're invited to Token Managerã€
   å…§å®¹ï¼šé»æ“Šé€£çµåŠ å…¥

4. ç”¨æˆ¶é»æ“Šé€£çµ
   â†“
   è·³è½‰åˆ°ï¼šhttp://localhost:5173
   â†“
   Clerk ç™»å…¥é é¢ï¼ˆæ”¯æŒ Google Loginï¼‰

5. ç”¨æˆ¶ä½¿ç”¨ Google ç™»å…¥
   â†“
   Clerk è‡ªå‹•å‰µå»ºç”¨æˆ¶
   â†“
   è‡ªå‹•å¸¶ä¸Š public_metadataï¼ˆåŒ…å« teamRolesï¼‰

6. å®Œæˆï¼ç”¨æˆ¶ç™»å…¥å¾Œï¼š
   - å·²ç¶“æœ‰ Backend DEVELOPER å’Œ Platform VIEWER è§’è‰²
   - å¯ä»¥ç«‹å³ä½¿ç”¨ç³»çµ±
```

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### 1. å•Ÿå‹•ç³»çµ±
```bash
# å¾Œç«¯
cd backend
source .venv/bin/activate
uvicorn main:app --reload --port 8000

# å‰ç«¯
cd frontend
npm run dev
```

### 2. æ¸¬è©¦åœ˜éšŠç®¡ç†

#### å‰µå»ºåœ˜éšŠ
1. ç™»å…¥ç‚º ADMIN
2. é»æ“Šå´é‚Šæ¬„ã€Œåœ˜éšŠç®¡ç†ã€
3. é»æ“Šã€Œå‰µå»ºåœ˜éšŠã€
4. å¡«å¯«ï¼š
   - ID: `marketing-team`
   - åç¨±: `Marketing Team`
   - æè¿°: `è¡ŒéŠ·åœ˜éšŠ`
   - é¡è‰²: é¸æ“‡
   - åœ–æ¨™: `ğŸ“¢`
5. é»æ“Šã€Œå‰µå»ºåœ˜éšŠã€
6. âœ… æ‡‰è©²çœ‹åˆ°æ–°åœ˜éšŠå‡ºç¾åœ¨åˆ—è¡¨

#### ç·¨è¼¯åœ˜éšŠ
1. é»æ“Šåœ˜éšŠçš„ã€Œç·¨è¼¯ã€æŒ‰éˆ•
2. ä¿®æ”¹åç¨±æˆ–æè¿°
3. é»æ“Šã€Œä¿å­˜ã€
4. âœ… æ‡‰è©²çœ‹åˆ°æ›´æ–°

#### åˆªé™¤åœ˜éšŠ
1. é»æ“Šã€Œåˆªé™¤ã€æŒ‰éˆ•
2. ç¢ºèªåˆªé™¤
3. âœ… åœ˜éšŠæ¶ˆå¤±

### 3. æ¸¬è©¦é‚€è«‹ç”¨æˆ¶

1. åœ¨ç”¨æˆ¶ç®¡ç†é é¢é»æ“Šã€Œé‚€è«‹ç”¨æˆ¶ã€
2. è¼¸å…¥ Email: `newuser@example.com`
3. é¸æ“‡åœ˜éšŠï¼š
   - â˜‘ Backend Team - DEVELOPER
   - â˜‘ Platform Team - VIEWER
4. é»æ“Šã€Œç™¼é€é‚€è«‹ã€
5. âœ… æ‡‰è©²çœ‹åˆ°æˆåŠŸæç¤º

**æ³¨æ„ï¼š** æ–°ç”¨æˆ¶è¦ç­‰ä»–é»æ“Šéƒµä»¶é€£çµä¸¦è¨»å†Šå¾Œæ‰æœƒå‡ºç¾åœ¨åˆ—è¡¨

---

## ğŸ“ è³‡æ–™åº«ç‹€æ…‹

### é è¨­åœ˜éšŠï¼ˆè‡ªå‹•å‰µå»ºï¼‰

ç³»çµ±å•Ÿå‹•æ™‚è‡ªå‹•æ’å…¥ 5 å€‹é è¨­åœ˜éšŠï¼š
```sql
'platform-team'  - Platform Team  - ğŸ—ï¸ - #8b5cf6
'backend-team'   - Backend Team   - âš™ï¸ - #3b82f6
'frontend-team'  - Frontend Team  - ğŸ¨ - #10b981
'data-team'      - Data Team      - ğŸ“Š - #f59e0b
'devops-team'    - DevOps Team    - ğŸš€ - #ef4444
```

### æŸ¥è©¢åœ˜éšŠ
```bash
# é€£æ¥åˆ° PostgreSQL
psql $DATABASE_URL

# æŸ¥è©¢æ‰€æœ‰åœ˜éšŠ
SELECT * FROM teams;
```

---

## âœ¨ å®Œæˆï¼

**æ–°åŠŸèƒ½ï¼š**
- âœ… åœ˜éšŠç®¡ç†ï¼ˆå‰µå»ºã€ç·¨è¼¯ã€åˆªé™¤ï¼‰
- âœ… ç”¨æˆ¶é‚€è«‹ï¼ˆClerk Invitationsï¼‰
- âœ… Google Login æ”¯æŒ
- âœ… è‡ªå‹•åˆ†é…åœ˜éšŠè§’è‰²

**æ¶æ§‹ï¼š**
- âœ… PostgreSQL å­˜åœ˜éšŠå®šç¾©
- âœ… Clerk Metadata å­˜ç”¨æˆ¶è§’è‰²
- âœ… å–®å‘é©—è­‰ä¿è­‰åŒæ­¥

**é›¶è£œä¸ï¼Œé‚è¼¯æ¸…æ™°ï¼** ğŸš€

